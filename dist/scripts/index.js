function setupFullscreen(){function e(){$("body").removeClass("has-fullscreen"),i=null}function n(e){i=e;var n=e.find("img, video").first().clone(),t=e.find(".loading-spinner").clone();if(a.empty().append(n).append(t),n.is("video")){setTimeout(function(){a.addClass("loading")},10),n.on("canplay",function(){n.addClass("loaded"),a.addClass("loaded").removeClass("loading"),n.get(0).play()});var o=n.get(0);o.load()}setTimeout(function(){$("body").addClass("has-fullscreen")},10)}var a=$("<div>").addClass("fullscreen-overlay loader-parent").click(function(){e()}).appendTo("body"),i=null;$(".page:not(.no-fullscreen) .media").click(function(){a.removeClass("loaded loading"),$(this).parents(".panning").length>0||n($(this))}),$(document).on("keydown",function(n){27==n.keyCode&&e()}),window.loadFullscreenMedia=n,window.getCurrentFullscreenMedia=function(){return i}}function setupKeyboardNav(){$(document).on("keydown",function(e){if(37==e.keyCode||39==e.keyCode){var n=37==e.keyCode?-1:1;if($("body").hasClass("has-fullscreen")){var a=getCurrentFullscreenMedia();if(a){var i=a.parent(".page"),t=i[n==-1?"prev":"next"](".page:not(.no-fullscreen)");t.length&&loadFullscreenMedia(t.find(".media"))}}else{var o=$(window).height(),s=null,d=0;$(".pages").each(function(){var e=$(this).get(0).getBoundingClientRect(),n=e.bottom-e.top,a=Math.min(e.bottom,o)-Math.max(e.top,0),i=a/n;i>d&&(s=this,d=i)}),s&&s.snapToPage&&s.snapToPage(s.getCurrentPage()+n)}}})}function setupVideoMedia(){function e(){var e=$(window).width(),a=$(window).height();n.each(function(){var i=$(this).get(0).getBoundingClientRect();i.bottom<0||i.right<0||i.left>e||i.top>a||($(this).addClass("was-visible"),n=$("section.project:not(.was-visible)"),loadPage($(this).find(".page").first()))})}$(document).on("mouseenter",".page.video .media",function(){}).on("mouseleave",".page.video .media",function(){}).on("click",".page.video .media",function(){});var n=$("section.project:not(.was-visible)");e(),$(window).on("scroll resize",e)}function setupMediaSizing(){$(".media video").on("resize",function(){sizeMedia($(this).parents(".media"))}),$(".media img").on("load",function(){sizeMedia($(this).parents(".media"))})}function sizeMedia(e){var n=e.children().eq(0);if(n.length&&!e.parent(".page").hasClass("no-scale")){var a=e.width(),i=e.height(),t=n.get(0).offsetWidth,o=n.get(0).offsetHeight,s=1;s=t/o>a/i?a/t:i/o,s=Math.min(s,1),n.css("transform","scale("+s+")")}}function buildPagers(){function e(){n=window.screen.width<480?16:32,a=16,i=$(".pages").width(),t=i-2*(n+a),$(".page").css({width:t,minWidth:t,marginRight:a}),$(".page:first-child").css({marginLeft:a+n}),$(".page:last-child").css({marginRight:n}),$(".media").each(function(){sizeMedia($(this))})}var n,a,i,t;e(),$(window).resize(e),$(".pages").each(function(){var e,i=$(this),o=this,s=$(this).find(".page-scroll"),d=$(this).find(".page"),l=0,c=-1,r=!1,u={};i.on("dragstart",function(e){e.preventDefault()}).on("click",function(e){r&&(e.preventDefault(),e.stopPropagation())}).on("wheel",function(e){Math.abs(e.originalEvent.deltaX)&&e.preventDefault()});var g=d.length;if(!(g<=1)){i.addClass("pannable");var p=function(e){e<0||e>=g||e in u||(u[e]=!0,loadPage(d.eq(e)))},f=function(n,i,o){void 0===o&&(o=!0),void 0===i&&(i=!1),l=Math.max(0,Math.min((t+a)*(g-1),n)),s.toggleClass("animate-scroll",i).css("transform","translate3d("+-l+"px,0,0)");var d=Math.round(l/t);c!=d&&(c=d,o&&(p(c-1),p(c),p(c+1)),e.find(".page-dot").each(function(e){$(this).toggleClass("active",e==c)}))},h=function(e){f(e*(t+a),!0)};o.snapToPage=h,o.getCurrentPage=function(){return c},$("<div>").addClass("edge-clicker prev").css("width",n).appendTo(i).click(function(){h(c-1)}),$("<div>").addClass("edge-clicker next").css("width",n).appendTo(i).click(function(){h(c+1)}),e=$("<div>").addClass("page-dots").appendTo(i);for(var v=function(){h($(this).index())},m=0;m<g;m++)e.append($("<div>").addClass("page-dot").click(v));var C=0,w=-1,y=!1,b=new Hammer(i.get(0),{dragLockToAxis:!0});b.on("panend pan swipe",function(e){e.preventDefault(),e.srcEvent.preventDefault();var n=e.deltaX<0;switch(e.type){case"pan":if(!y){var a=e.deltaX-C;r=!0,w<0&&(w=c),i.addClass("panning"),f(l-a),C=e.deltaX}break;case"swipe":y=!0,C=0,n=0==(e.direction&Hammer.DIRECTION_RIGHT),h(w+(n?1:-1)),setTimeout(function(){r=!1,w=-1,i.removeClass("panning")},0),e.srcEvent.stopPropagation();break;case"panend":y||(C=0,h(c),setTimeout(function(){r=!1,w=-1,i.removeClass("panning")},0)),y=!1}});var M,k,T;i.on("wheel",function(e){var n=e.originalEvent.deltaX<0?-1:1,a=Math.abs(e.originalEvent.deltaX);return a<Math.abs(e.originalEvent.deltaY)||(T||a<30?(k=a,!1):((a>k||n!=M)&&(M=n,T=!0,setTimeout(function(){T=!1},300),h(c+n)),!1))}),f(0,!1,!1)}})}function loadPage(e){}function playVideoMedia(e,n){e.data("should-be-playing",n);var a=e.find("video");n?e.hasClass("loaded")?a.get(0).play():(e.addClass("loading"),a.off("canplay").on("canplay",function(){e.addClass("loaded").removeClass("loading"),e.data("should-be-playing")&&a.get(0).play()}),a.get(0).load()):a.get(0).pause()}$(document).ready(function(){buildPagers(),setupMediaSizing(),setupVideoMedia(),setupFullscreen(),setupKeyboardNav(),FastClick.attach(document.body),$(".project a").attr("target","_blank")});